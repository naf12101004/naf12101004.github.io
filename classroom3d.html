<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë„ˆì˜ ì´ë¦„ì€ - êµì‹¤ 3D ë·°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#fff;}
    #ui {
      position: fixed; left: 12px; top: 12px; z-index: 10; color:#111; font-family: system-ui, Arial, sans-serif;
      display:flex; flex-direction: column; gap:8px; width:min(92vw, 360px);
    }
    #ui .panel {
      background: rgba(255,255,255,0.75); border:1px solid rgba(0,0,0,0.1);
      border-radius: 12px; padding: 12px; backdrop-filter: blur(6px);
    }
    #ui button { background:#4CAF50; color:#fff; cursor:pointer; border:none; padding:10px; border-radius:10px;}
    #ui button.secondary { background:#2d2d2d; }
    canvas { display:block; }
  </style>
</head>
<body>
  <div id="ui">
    <div class="panel" id="panel-year">
      <label>ì‚¬ìš©í•  ì—°ë„ (ì €ì¥ëœ ìë¦¬ë°°ì¹˜):</label>
      <input id="year" placeholder="ì˜ˆ: 2025" maxlength="4" inputmode="numeric" pattern="\d{4}" />
      <button id="applyYear">ì´ ì—°ë„ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>
    <div class="panel">
      <button id="sensor">ğŸ“± ì„¼ì„œ(íšŒì „) ì‹œì‘</button>
      <button class="secondary" id="centerBoard">ğŸ”„ ì¹ íŒ ë³´ê¸°</button>
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button id="firstPerson" class="secondary">ğŸ‘ï¸ 1ì¸ì¹­</button>
        <button id="thirdPerson" class="secondary">ğŸ§ 3ì¸ì¹­</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    // ====== ê¸°ë³¸ ì„¸íŒ… ======
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xffffff);
    const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 2000);
    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(innerWidth, innerHeight);
    document.body.appendChild(renderer.domElement);

    // ====== ì¡°ëª… ======
    scene.add(new THREE.HemisphereLight(0xffffff, 0xe0e0e0, 0.85));
    const dir = new THREE.DirectionalLight(0xffffff, 0.9);
    dir.position.set(10, 20, 10);
    scene.add(dir);

    // ====== êµì‹¤ ê·¸ë£¹ ======
    const classroom = new THREE.Group();
    scene.add(classroom);

    // ====== ë°”ë‹¥ ======
    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(72, 48),
      new THREE.MeshStandardMaterial({ color:0x7c7c7c, roughness:1 })
    );
    floor.rotation.x = -Math.PI/2;
    classroom.add(floor);

    // ====== ì¹ íŒ ======
    const BOARD_Z = -(48/2) + 2;
    const board = new THREE.Mesh(
      new THREE.PlaneGeometry(24, 6),
      new THREE.MeshStandardMaterial({ color:0x0f9d58 })
    );
    board.position.set(0, 6, BOARD_Z);
    classroom.add(board);

    // ====== ì±…ìƒ íŒŒë¼ë¯¸í„° ======
    let rows = 4, cols = 6;
    const desk = { w: 5, h: 3, gapX: 1.2, gapZ: 2.0 };
    let desks = [];

    // ====== í…ìŠ¤íŠ¸ ë¼ë²¨ ë§Œë“¤ê¸° ======
    function makeTextSprite(text, pos, opts={}) {
      const font = opts.font || '600 36px system-ui, Arial';
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.font = font;
      canvas.width = ctx.measureText(text).width + 32;
      canvas.height = 64 + 32;

      // ğŸ”¹ ê¸€ì ìƒ‰ìƒì€ ì—¬ê¸°ì„œ ë°”ê¿‰ë‹ˆë‹¤
      ctx.fillStyle = opts.color || '#ffffff'; 
      ctx.textBaseline = 'middle';
      ctx.fillText(text, 16, canvas.height/2);

      const tex = new THREE.CanvasTexture(canvas);
      const material = new THREE.SpriteMaterial({ map: tex, transparent:true });
      const sprite = new THREE.Sprite(material);

      // ğŸ”¹ scale ê°’ì´ í´ìˆ˜ë¡ ì „ì²´ í¬ê¸°ê°€ ì»¤ì§‘ë‹ˆë‹¤
      const scale = opts.scale || 0.05;
      sprite.scale.set(canvas.width*scale, canvas.height*scale, 1);
      sprite.position.set(pos.x, pos.y, pos.z);
      return sprite;
    }

    // ====== ì±…ìƒ ì¹´ë“œ (ì‚¬ì§„ + ì´ë¦„ + ë©”ëª¨) ======
    function makeDeskCard(d, basePos) {
      const group = new THREE.Group();

      // ğŸ“· ì‚¬ì§„ (ë†’ì´: basePos.y + 2.0)
      if (d && d.photo) {
        const tex = new THREE.TextureLoader().load(d.photo);
        const photo = new THREE.Mesh(
          new THREE.PlaneGeometry(3.2, 2.2),
          new THREE.MeshStandardMaterial({ map: tex, side:THREE.DoubleSide })
        );
        photo.position.set(basePos.x, basePos.y + 2.0, basePos.z);
        group.add(photo);
      }

      // ğŸ·ï¸ ì´ë¦„ ë¼ë²¨
      group.add(makeTextSprite(
        d?.name || '(ë¹ˆìë¦¬)',
        { x: basePos.x, y: basePos.y + 4.0, z: basePos.z }, // ğŸ”¹ ìœ„ì¹˜ (yê°’ì„ ë°”ê¾¸ë©´ ìœ„/ì•„ë˜ ì´ë™)
        {
          font:'600 28px system-ui, Arial', // ğŸ”¹ ê¸€ê¼´/êµµê¸°/í¬ê¸°(px)
          scale:0.045,                      // ğŸ”¹ ê¸€ì ì „ì²´ í¬ê¸° ë°°ìœ¨
          color:'#000000'                   // ğŸ”¹ ê¸€ì ìƒ‰ìƒ (ì—¬ê¸°ì„œ ë°”ê¾¸ì„¸ìš”)
        }
      ));

      // ğŸ“ ë©”ëª¨ ë¼ë²¨
      if (d && d.memo) {
        group.add(makeTextSprite(
          d.memo,
          { x: basePos.x, y: basePos.y + 5.0, z: basePos.z }, // ğŸ”¹ í˜„ì¬ ì´ë¦„ë³´ë‹¤ ìœ„
          {
            font:'500 22px system-ui, Arial', // ğŸ”¹ ê¸€ê¼´/êµµê¸°/í¬ê¸°(px)
            scale:0.014,                      // ğŸ”¹ ë©”ëª¨ í¬ê¸° (ì‘ê²Œ ë³´ì´ë„ë¡ ì„¤ì •)
            color:'#2196F3'                   // ğŸ”¹ íŒŒë€ìƒ‰ ì˜ˆì‹œ (ì›í•˜ë©´ ë³€ê²½)
          }
        ));
      }
      return group;
    }

    // ====== êµì‹¤ ì¬êµ¬ì„± ======
    function rebuildClassroom() {
      desks.forEach(d => {
        classroom.remove(d.mesh);
        if (d.card) classroom.remove(d.card);
      });
      desks = [];
      for (let i=0;i<rows;i++){
        for (let j=0;j<cols;j++){
          const mesh = new THREE.Mesh(
            new THREE.BoxGeometry(desk.w, 0.2, desk.h),
            new THREE.MeshStandardMaterial({ color:0x8B4513 })
          );
          mesh.position.set(
            j*(desk.w+desk.gapX) - (cols*desk.w + (cols-1)*desk.gapX)/2 + desk.w/2,
            0.2, 
            i*(desk.h+desk.gapZ) - (rows*desk.h + (rows-1)*desk.gapZ)/2 + desk.h/2
          );
          classroom.add(mesh);
          const basePos = new THREE.Vector3(mesh.position.x, 1.1, mesh.position.z);
          const card = makeDeskCard({name:`í•™ìƒ${i*cols+j+1}`, memo:'ë©”ëª¨'}, basePos);
          classroom.add(card);
          desks.push({mesh,card});
        }
      }
    }

    // ====== ì¹´ë©”ë¼ ======
    let cameraMode = 'tp';
    function placeCamera(){ camera.position.set(0,18,26); camera.lookAt(new THREE.Vector3(0,5,BOARD_Z)); }

    // ====== ì´ˆê¸° ì‹¤í–‰ ======
    rebuildClassroom();
    placeCamera();
    (function animate(){ requestAnimationFrame(animate); renderer.render(scene, camera); })();
  </script>
</body>
</html>
