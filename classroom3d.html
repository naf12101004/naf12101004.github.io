<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë„ˆì˜ ì´ë¦„ì€ - êµì‹¤ 3D ë·°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* âœ… ì „ì²´ ë°°ê²½ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
    html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#fff;}
    #ui {
      position: fixed; left: 12px; top: 12px; z-index: 10; color:#111; font-family: system-ui, Arial, sans-serif;
      display:flex; flex-direction: column; gap:8px; width:min(92vw, 360px);
    }
    #ui .panel {
      background: rgba(255,255,255,0.75); border:1px solid rgba(0,0,0,0.1);
      border-radius: 12px; padding: 12px; backdrop-filter: blur(6px);
    }
    #ui label { font-size:14px; opacity:0.9; display:block; margin-bottom:4px;}
    #ui input, #ui button, #ui select {
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.15); outline:none; font-size:14px;
      background:#fff; color:#111;
    }
    #ui button { background:#4CAF50; color:#fff; cursor:pointer; border:none;}
    #ui button.secondary { background:#2d2d2d; }
    #hint { position: fixed; bottom: 12px; left: 12px; right:12px; color:#555; font-size:12px; text-align:center; opacity:0.8;}
    canvas { display:block; }

    /* âœ… ê¸°ë³¸ ê²©ì íŒ¨ë„: ê¸°ëŠ¥ ìœ ì§€, í•­ìƒ ìˆ¨ê¹€ */
    #panel-grid { display:none !important; }

    /* ===== ëª¨ë°”ì¼ ìµœì í™”: ë„ˆë¹„ 640px ì´í•˜(í°)ì—ì„œë§Œ ì¶”ê°€ ì¡°ì • ===== */
    @media (max-width: 640px) {
      #ui { width: min(92vw, 300px); }
      #panel-grid { display: none !important; }

      /* ì—°ë„ íŒ¨ë„: ì…ë ¥/ë²„íŠ¼ ë‚˜ë€íˆ ì»´íŒ©íŠ¸ */
      #panel-year {
        display: grid;
        grid-template-columns: 1fr auto;
        grid-template-rows: auto auto;
        gap: 8px;
        align-items: center;
      }
      #panel-year > label {
        grid-column: 1 / -1;
        margin-bottom: 0;
        font-size: 13px;
      }
      #year {
        max-width: 120px;
        width: 100%;
        font-variant-numeric: tabular-nums;
      }
      #applyYear {
        width: auto;
        padding: 8px 10px !important;
        font-size: 13px;
        white-space: nowrap;
      }
      #ui input, #ui button, #ui select {
        padding: 8px 10px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div id="ui">
    <!-- ì‚¬ìš© ì—°ë„ íŒ¨ë„ -->
    <div class="panel" id="panel-year">
      <label>ì‚¬ìš©í•  ì—°ë„ (ì €ì¥ëœ ìë¦¬ë°°ì¹˜):</label>
      <input id="year" placeholder="ì˜ˆ: 2025" maxlength="4" inputmode="numeric" pattern="\d{4}" />
      <button id="applyYear">ì´ ì—°ë„ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>

    <!-- ê¸°ë³¸ ê²©ì íŒ¨ë„: ì½”ë“œ ìœ ì§€(ì „ì—­ CSSë¡œ ë¹„ê°€ì‹œí™”) -->
    <div class="panel" id="panel-grid">
      <label>ê¸°ë³¸ ê²©ì (í–‰ Ã— ì—´) â€” ì €ì¥ê°’ ì—†ì„ ë•Œë§Œ ì‚¬ìš©</label>
      <div style="display:flex; gap:8px;">
        <input id="rows" type="number" placeholder="í–‰(ì˜ˆ:4)" />
        <input id="cols" type="number" placeholder="ì—´(ì˜ˆ:6)" />
      </div>
      <button class="secondary" id="regen">êµì‹¤ ë‹¤ì‹œ ë§Œë“¤ê¸°</button>
    </div>

    <div class="panel">
      <button id="sensor">ğŸ“± ì„¼ì„œ(íšŒì „) ì‹œì‘</button>
      <button class="secondary" id="centerBoard">ğŸ”„ ì¹ íŒ ë³´ê¸°</button>
      <!-- ì‹œì  ì „í™˜ -->
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button id="firstPerson" class="secondary">ğŸ‘ï¸ 1ì¸ì¹­</button>
        <button id="thirdPerson" class="secondary">ğŸ§ 3ì¸ì¹­</button>
      </div>
    </div>
  </div>

  <div id="hint">ì¢Œìš°ë¡œ ê¸°ê¸°ë¥¼ ëŒë¦¬ë©´ íšŒì „ Â· í™”ë©´ì„ í„°ì¹˜í•œ ì±„ ì•„ë˜ë¡œ ì“¸ì–´ë‚´ë¦¬ë©´ ì „ì§„ / ìœ„ë¡œ ì“¸ì–´ì˜¬ë¦¬ë©´ í›„ì§„<br/>â€œë‚˜â€ê°€ ì—†ìœ¼ë©´ êµì‹¤ ì¤‘ì•™ ì‹œì ì—ì„œ ì‹œì‘</div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    // ====== ê¸°ì´ˆ ì„¸íŒ… ======
    const scene = new THREE.Scene();
    /* âœ… ì¥ë©´ ë°°ê²½ í°ìƒ‰ */
    scene.background = new THREE.Color(0xffffff);

    const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 2000);
    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(innerWidth, innerHeight);
    document.body.appendChild(renderer.domElement);

    // ì¡°ëª…
    const hemi = new THREE.HemisphereLight(0xffffff, 0xe0e0e0, 0.85);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.9);
    dir.position.set(10, 20, 10);
    scene.add(dir);

    // êµì‹¤ ê·¸ë£¹(ì¹´ë©”ë¼ ê³ ì •, êµì‹¤ì„ ì›€ì§ì´ëŠ” ë°©ì‹)
    const classroom = new THREE.Group();
    scene.add(classroom);

    // ë°”ë‹¥ (ë°ì€ í†¤)
    const FLOOR_W = 72, FLOOR_H = 48;
    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(FLOOR_W, FLOOR_H),
      new THREE.MeshStandardMaterial({ color:0xf3f3f3, metalness:0.0, roughness:1.0 })
    );
    floor.rotation.x = -Math.PI/2;
    classroom.add(floor);

    // ì¹ íŒ(ì•ìª½ ë²½)
    const boardW = 24, boardH = 6;
    const board = new THREE.Mesh(
      new THREE.PlaneGeometry(boardW, boardH),
      new THREE.MeshStandardMaterial({ color:0x0f9d58, roughness:0.9, metalness:0 })
    );
    const BOARD_Z = - (FLOOR_H/2) + 2; // ì•ìª½
    board.position.set(0, 6, BOARD_Z);
    classroom.add(board);

    // âœ… ì¹ íŒ ë¼ë²¨: "ì¹ íŒ" (ê²€ì€ ë°°ê²½ ì œê±°, ì¹ íŒ ì¤‘ì•™ ì •ë ¬)
    //    - ìœ„ì¹˜: ì¹ íŒ íŒë©´ ì¤‘ì•™ (x=0, y=6, z=BOARD_Z + 0.01)
    //    - ë°°ê²½: ì—†ìŒ(bg:false)
    classroom.add(
      makeTextSprite("ì¹ íŒ", {x:0, y:6, z:BOARD_Z+0.01}, { font:'700 40px system-ui, Arial', scale:0.05, bg:false })
    );

    // í–‰/ì—´ ë° ì±…ìƒ íŒŒë¼ë¯¸í„°
    let rows = 4, cols = 6;
    const desk = { w: 5, h: 3, y: 1.2, gapX: 1.2, gapZ: 2.0 };
    let desks = []; // {mesh, card, data, index, rc:{r,c}}

    // ====== ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ======
    function loadSaved() {
      const year = (document.getElementById('year').value || localStorage.getItem('savedYear') || '').trim();
      if (year) document.getElementById('year').value = year;

      // seatData_YEAR
      const raw = year ? localStorage.getItem(`seatData_${year}`) : null;
      const seatData = raw ? JSON.parse(raw) : [];

      // ì €ì¥ëœ ë ˆì´ì•„ì›ƒ ë©”íƒ€(ìˆìœ¼ë©´ ì‚¬ìš©). ì—†ìœ¼ë©´ ì…ë ¥ì°½/ê¸°ë³¸ê°’.
      const metaRows = parseInt(localStorage.getItem(`layout_rows_${year}`) || '') || parseInt(document.getElementById('rows').value || '') || rows;
      const metaCols = parseInt(localStorage.getItem(`layout_cols_${year}`) || '') || parseInt(document.getElementById('cols').value || '') || cols;

      rows = metaRows > 0 ? metaRows : rows;
      cols = metaCols > 0 ? metaCols : cols;

      // ì…ë ¥ì°½ ë™ê¸°í™” (íŒ¨ë„ì€ ìˆ¨ê¹€ì´ì§€ë§Œ ê¸°ëŠ¥ ìœ ì§€)
      document.getElementById('rows').value = rows;
      document.getElementById('cols').value = cols;

      return { year, seatData };
    }

    // ====== ì±…ìƒ ê·¸ë£¹ ìƒì„±: ìƒíŒ + 4ë‹¤ë¦¬ ======
    function makeDeskGroup(w, h) {
      const group = new THREE.Group();

      const topThickness = 0.2;     // ìƒíŒ ë‘ê»˜
      const legWidth = 0.15;        // ë‹¤ë¦¬ êµµê¸° (ì •ì‚¬ê° ë‹¨ë©´)
      const legHeight = 2.0;        // ë‹¤ë¦¬ ê¸¸ì´ (ë°”ë‹¥~ìƒíŒ í•˜ë‹¨)
      const topY = legHeight + topThickness/2; // ìƒíŒ ì¤‘ì‹¬ ë†’ì´

      // ìƒíŒ
      const top = new THREE.Mesh(
        new THREE.BoxGeometry(w, topThickness, h),
        new THREE.MeshStandardMaterial({ color:0x8B4513, roughness:0.9, metalness:0.05 }) // ëª©ì¬ í†¤
      );
      top.position.set(0, topY, 0);
      group.add(top);

      // ë‹¤ë¦¬ ìœ„ì¹˜ ë³´ì •(ìƒíŒ ëª¨ì„œë¦¬ ì•ˆìª½)
      const dx = (w/2 - legWidth/2) - 0.1;
      const dz = (h/2 - legWidth/2) - 0.1;

      // ê³µìš© ë¨¸í‹°ë¦¬ì–¼(ë‹¤ë¦¬: ì•½ê°„ ë” ì–´ë‘¡ê²Œ)
      const legMat = new THREE.MeshStandardMaterial({ color:0x5A2E0C, roughness:0.9, metalness:0.02 });

      // 4ê°œ ë‹¤ë¦¬
      const legGeo = new THREE.BoxGeometry(legWidth, legHeight, legWidth);
      const legPositions = [
        [+dx, legHeight/2, +dz],
        [-dx, legHeight/2, +dz],
        [+dx, legHeight/2, -dz],
        [-dx, legHeight/2, -dz],
      ];
      for (const p of legPositions) {
        const leg = new THREE.Mesh(legGeo, legMat);
        leg.position.set(p[0], p[1], p[2]);
        group.add(leg);
      }

      return group;
    }

    // ====== êµì‹¤/ì±…ìƒ ì¬êµ¬ì„± ======
    function rebuildClassroom() {
      // ê¸°ì¡´ ì±…ìƒ ì œê±°
      desks.forEach(d => {
        classroom.remove(d.mesh);
        if (d.card) classroom.remove(d.card);
      });
      desks = [];

      // í˜„ì¬ seatData
      const { seatData } = loadSaved();
      const total = Math.max(seatData.length || 0, rows*cols);

      // ê·¸ë¦¬ë“œ ì‹œì‘ ì˜¤í”„ì…‹(ì¤‘ì•™ ì •ë ¬)
      const totalW = cols*desk.w + (cols-1)*desk.gapX;
      const totalH = rows*desk.h + (rows-1)*desk.gapZ;
      const startX = -totalW/2 + desk.w/2;
      const startZ = -totalH/2 + desk.h/2;

      for (let i=0; i<rows; i++) {
        for (let j=0; j<cols; j++) {
          const idx = i*cols + j;
          if (idx >= total) break;

          // âœ… ì±…ìƒ: ê·¸ë£¹(ìƒíŒ+ë‹¤ë¦¬)ìœ¼ë¡œ ìƒì„±
          const mesh = makeDeskGroup(desk.w, desk.h);
          mesh.position.set(
            startX + j*(desk.w + desk.gapX),
            0,                                            // ê·¸ë£¹ì€ ë°”ë‹¥ ê¸°ì¤€
            startZ + i*(desk.h + desk.gapZ)
          );
          classroom.add(mesh);

          const d = seatData[idx] || null;
          // ì¹´ë“œ(ì‚¬ì§„+ì´ë¦„+ë©”ëª¨)
          let card = null;
          if (d && (d.name || d.memo || d.photo)) {
            // ğŸ“Œ ê¸°ì¡´ ê¸°ì¤€ ë†’ì´(1.1)ë¥¼ ìœ ì§€í•˜ë„ë¡ basePos.yë¥¼ 1.1ë¡œ ê³ ì • ì „ë‹¬
            const basePos = new THREE.Vector3(mesh.position.x, 1.1, mesh.position.z);
            card = makeDeskCard(d, basePos);
            classroom.add(card);
          }

          desks.push({ mesh, card, data:d, index:idx, rc:{r:i, c:j} });
        }
      }
    }

    // ====== í…ìŠ¤íŠ¸ ë¼ë²¨(ìº”ë²„ìŠ¤ í…ìŠ¤ì²˜) ======
    function makeTextSprite(text, pos, opts={}) {
      const font = opts.font || '600 36px system-ui, Arial';
      const padding = 16;
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      ctx.font = font;
      const tw = Math.ceil(ctx.measureText(text).width);
      canvas.width = tw + padding*2;
      canvas.height = 64 + padding*2;

      // âœ… opts.bg === falseë©´ ë°°ê²½ ìƒëµ
      if (opts.bg !== false) {
        ctx.fillStyle = 'rgba(0,0,0,0.6)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      // ê¸€ì
      ctx.font = font;
      ctx.fillStyle = '#ffffff';
      ctx.textBaseline = 'middle';
      ctx.fillText(text, padding, canvas.height/2);

      const tex = new THREE.CanvasTexture(canvas);
      tex.minFilter = THREE.LinearFilter;
      const material = new THREE.SpriteMaterial({ map: tex, transparent:true });
      const sprite = new THREE.Sprite(material);
      const scale = opts.scale || 0.06; // í™”ë©´ ë„ˆë¹„ ë¹„ë¡€ ê°
      sprite.scale.set(canvas.width*scale, canvas.height*scale, 1);
      sprite.position.set(pos.x, pos.y, pos.z);
      return sprite;
    }

    // ====== ì±…ìƒ ì¹´ë“œ(ì‚¬ì§„ + í…ìŠ¤íŠ¸) ======
    function makeDeskCard(d, basePos) {
      const group = new THREE.Group();

      // ì‚¬ì§„
      if (d.photo) {
        const tex = new THREE.TextureLoader().load(d.photo);
        const imgW = 3.2, imgH = 2.2;
        const photo = new THREE.Mesh(
          new THREE.PlaneGeometry(imgW, imgH),
          new THREE.MeshStandardMaterial({ map: tex, roughness:1, metalness:0, side:THREE.DoubleSide })
        );
        photo.position.set(basePos.x, basePos.y + 2.0, basePos.z);
        photo.rotation.y = 0;

        // í´ë¦­ ì´ë²¤íŠ¸
        photo.userData = { fullsize: d.photo };
        photo.cursor = 'pointer';
        photo.callback = () => showPhotoModal(d.photo);

        group.add(photo);

        // ì•¡ì ë°›ì¹¨
        const stand = new THREE.Mesh(
          new THREE.BoxGeometry(imgW+0.2, 0.1, 0.4),
          new THREE.MeshStandardMaterial({ color:0x666666 })
        );
        stand.position.set(basePos.x, basePos.y + 1.0, basePos.z - 0.2);
        group.add(stand);
      }

      // ì´ë¦„/ë©”ëª¨ ë¼ë²¨ (ë°°ê²½ ì œê±°, í¬ê¸° ì¡°ì •, ê²¹ì¹¨ ë°©ì§€ ìœ„í•´ yë¥¼ ì˜¬ë¦¼)
      const nameText = (d.name || '').trim() || '(ë¹ˆìë¦¬)';
      const memoText = (d.memo || '').trim();

      const nameLabel = makeTextSprite(
        nameText,
        { x: basePos.x, y: basePos.y + 3.7, z: basePos.z },
        { font:'600 28px system-ui, Arial', scale:0.045, bg:false }
      );
      group.add(nameLabel);

      if (memoText) {
        const memoLabel = makeTextSprite(
          memoText,
          { x: basePos.x, y: basePos.y + 3.25, z: basePos.z },
          { font:'500 22px system-ui, Arial', scale:0.04, bg:false }
        );
        group.add(memoLabel);
      }

      return group;
    }

    // ====== ì‹œì (ì¹´ë©”ë¼) ëª¨ë“œ ======
    let cameraMode = 'fp'; // 'fp' = 1ì¸ì¹­(ê¸°ë³¸), 'tp' = 3ì¸ì¹­

    // ====== â€œë‚˜â€ ìë¦¬ ê¸°ì¤€ ì¹´ë©”ë¼ ë°°ì¹˜ (ëª¨ë“œ ë°˜ì˜) ======
    function placeCameraAtMySeat() {
      const { seatData } = loadSaved();
      const myIndex = (seatData || []).findIndex(d => d && typeof d.name === 'string' && d.name.trim() === 'ë‚˜');

      const totalW = cols*desk.w + (cols-1)*desk.gapX;
      const totalH = rows*desk.h + (rows-1)*desk.gapZ;
      const startX = -totalW/2 + desk.w/2;
      const startZ = -totalH/2 + desk.h/2;

      // ê¸°ë³¸(ì¤‘ì•™) ê°’
      let camX = 0, camY = 16, camZ = 26;

      if (myIndex >= 0) {
        const r = Math.floor(myIndex / cols);
        const c = myIndex % cols;
        const myX = startX + c*(desk.w + desk.gapX);
        const myZ = startZ + r*(desk.h + desk.gapZ);

        if (cameraMode === 'fp') {
          // 1ì¸ì¹­: 'ë‚˜' ìë¦¬ ë†’ì´ì—ì„œ ì¹ íŒì„ ë°”ë¼ë´„
          camX = myX;
          camY = 1.6 + 1.2;
          camZ = myZ;
          camera.position.set(camX, camY, camZ);
          camera.lookAt(new THREE.Vector3(0, 5, BOARD_Z));
          return;
        } else {
          // 3ì¸ì¹­: ê¸°ì¡´ ìŠ¤íƒ€ì¼
          camX = myX;
          camY = 18;
          camZ = myZ + 24;
        }
      } else {
        // 'ë‚˜'ê°€ ì—†ìœ¼ë©´
        if (cameraMode === 'fp') {
          camX = 0; camY = 3; camZ = 20;
        } else {
          camX = 0; camY = 18; camZ = 26;
        }
      }

      camera.position.set(camX, camY, camZ);
      camera.lookAt(new THREE.Vector3(0, 5, BOARD_Z));
    }

    // ====== ì…ë ¥/ë²„íŠ¼ í•¸ë“¤ëŸ¬ ======
    document.getElementById('applyYear').addEventListener('click', () => {
      rebuildClassroom();
      placeCameraAtMySeat();
    });
    document.getElementById('regen').addEventListener('click', () => {
      // ìˆ¨ê¹€ ìƒíƒœì§€ë§Œ ê¸°ëŠ¥ì€ ìœ ì§€
      const r = parseInt(document.getElementById('rows').value || '') || rows;
      const c = parseInt(document.getElementById('cols').value || '') || cols;
      rows = r; cols = c;
      rebuildClassroom();
      placeCameraAtMySeat();
    });
    document.getElementById('centerBoard').addEventListener('click', () => {
      camera.lookAt(new THREE.Vector3(0, 5, BOARD_Z));
    });

    // ì‹œì  ì „í™˜ ë²„íŠ¼
    document.getElementById('firstPerson').addEventListener('click', () => {
      cameraMode = 'fp';
      placeCameraAtMySeat();
    });
    document.getElementById('thirdPerson').addEventListener('click', () => {
      cameraMode = 'tp';
      placeCameraAtMySeat();
    });

    // ====== ì„¼ì„œ(ê¸°ê¸° íšŒì „) â€” êµì‹¤ì„ íšŒì „ ======
    let baseAlpha = null;
    function handleOrientation(e) {
      if (typeof e.alpha !== 'number') return;
      if (baseAlpha === null) baseAlpha = e.alpha;
      const yaw = THREE.MathUtils.degToRad(-(e.alpha - baseAlpha)); // ì¢Œìš° ë°˜ì „ ìœ ì§€
      classroom.rotation.y = yaw;
    }
    async function enableSensor() {
      if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
        try {
          const p = await DeviceOrientationEvent.requestPermission();
          if (p !== 'granted') return alert('ì„¼ì„œ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch (err) {
          console.warn(err);
          return alert('ì„¼ì„œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜');
        }
      }
      window.addEventListener('deviceorientation', handleOrientation, true);
    }
    document.getElementById('sensor').addEventListener('click', enableSensor);

    // ====== í„°ì¹˜ ì œìŠ¤ì²˜(ì „ì§„/í›„ì§„) â€” êµì‹¤ì„ Zë°©í–¥ìœ¼ë¡œ ì´ë™ ======
    let touchStartY = null;
    let accumZ = 0;
    const MOVE_SCALE = 0.04;

    window.addEventListener('touchstart', (e) => {
      if (e.touches.length === 1) touchStartY = e.touches[0].clientY;
    }, {passive:true});

    window.addEventListener('touchmove', (e) => {
      if (touchStartY === null || e.touches.length !== 1) return;
      const y = e.touches[0].clientY;
      const dy = y - touchStartY;
      accumZ = THREE.MathUtils.clamp(accumZ - dy*MOVE_SCALE, -60, 60);
      classroom.position.z = accumZ;
      touchStartY = y;
    }, {passive:true});

    window.addEventListener('touchend', () => { touchStartY = null; });

    // ====== ë¦¬ì‚¬ì´ì¦ˆ ======
    addEventListener('resize', () => {
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });

    // ====== ì´ˆê¸° ë¹Œë“œ ======
    rebuildClassroom();
    placeCameraAtMySeat(); // ê¸°ë³¸: 1ì¸ì¹­

    // ====== ë£¨í”„ ======
    (function animate(){
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    })();

    // ====== í´ë¦­ ê°ì§€ ======
    renderer.domElement.addEventListener('click', function(e) {
      const mouse = new THREE.Vector2(
        (e.clientX / window.innerWidth) * 2 - 1,
        -(e.clientY / window.innerHeight) * 2 + 1
      );
      const raycaster = new THREE.Raycaster();
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(classroom.children, true);

      for (const intersect of intersects) {
        const obj = intersect.object;
        if (obj.callback) {
          obj.callback();
          break;
        }
      }
    });

    // ====== ì‚¬ì§„ í´ë¦­ ì‹œ í™•ëŒ€ íŒì—… ======
    function showPhotoModal(url) {
      document.getElementById("modalImage").src = url;
      document.getElementById("photoModal").style.display = "flex";
    }
    function closePhotoModal() {
      document.getElementById("photoModal").style.display = "none";
    }
  </script>
  
  <!-- ğŸ“· ì‚¬ì§„ í™•ëŒ€ìš© íŒì—… -->
  <div id="photoModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:100; justify-content:center; align-items:center;">
    <img id="modalImage" src="" style="max-width:90vw; max-height:90vh; border:4px solid white; border-radius:12px;" />
    <button onclick="closePhotoModal()" style="position:absolute; top:20px; right:20px; background:#f44336; color:white; border:none; padding:10px 16px; font-size:16px; border-radius:8px; cursor:pointer;">X</button>
  </div>

</body>
</html>
