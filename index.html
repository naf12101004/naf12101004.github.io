<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>자리 등록 - 너의 이름은...</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #333;
    }
    label {
      font-weight: bold;
    }
    .step {
      font-size: 13px;
      color: #777;
      margin-bottom: 4px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .seat {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      text-align: center;
      background-color: #fafafa;
      cursor: pointer;
    }
    #seatArea {
      margin-top: 20px;
    }
    #seatArea img {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>🪑 자리 정보 입력</h1>

  <div class="step">1. 연도 입력 (예: 2025)</div>
  <input type="text" id="year" placeholder="예: 2025">

  <div class="step">2. 내 이름 입력 (자리 강조용)</div>
  <input type="text" id="myName" placeholder="예: 홍길동">

  <div class="step">3. 가로 × 세로 자리 수 설정</div>
  <input type="number" id="cols" placeholder="가로 (예: 6)">
  <input type="number" id="rows" placeholder="세로 (예: 4)">
  <button onclick="generateSeats()">자리 만들기</button>

  <div class="step">4. 각 자리를 클릭해 정보 입력</div>
  <div id="seatArea"></div>

  <div class="step">5. 저장 및 불러오기</div>
  <button onclick="saveData()">자리 저장</button>
  <button onclick="loadData()">자리 불러오기</button>
</div>

<div id="popup" style="display:none; position:fixed; top:30%; left:50%; transform:translateX(-50%); background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.3);">
  <h3>자리 정보 입력</h3>
  <input type="text" id="popupName" placeholder="이름">
  <input type="text" id="popupMemo" placeholder="메모">
  <input type="file" id="popupPhoto" accept="image/*">
  <button onclick="saveSeatData()">저장</button>
  <button onclick="closePopup()">닫기</button>
</div>

<script>
let selectedSeat = null;
let seatData = [];

function generateSeats() {
  const cols = parseInt(document.getElementById('cols').value);
  const rows = parseInt(document.getElementById('rows').value);
  const seatArea = document.getElementById('seatArea');
  seatArea.innerHTML = '';
  seatData = new Array(rows * cols).fill(null);

  const grid = document.createElement('div');
  grid.style.display = 'grid';
  grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
  grid.style.gap = '8px';

  for (let i = 0; i < rows * cols; i++) {
    const seat = document.createElement('div');
    seat.className = 'seat';
    seat.innerText = `자리 ${i + 1}`;
    seat.dataset.index = i;
    seat.onclick = () => openPopup(seat);
    grid.appendChild(seat);
  }
  seatArea.appendChild(grid);
}

function openPopup(seat) {
  selectedSeat = seat;
  document.getElementById('popup').style.display = 'block';
}

function closePopup() {
  document.getElementById('popup').style.display = 'none';
  document.getElementById('popupName').value = '';
  document.getElementById('popupMemo').value = '';
  document.getElementById('popupPhoto').value = '';
}

function saveSeatData() {
  const name = document.getElementById('popupName').value;
  const memo = document.getElementById('popupMemo').value;
  const photoInput = document.getElementById('popupPhoto');
  const index = selectedSeat.dataset.index;

  const reader = new FileReader();
  const updateSeat = (photo) => {
    selectedSeat.innerHTML = '';
    if (photo) {
      const img = document.createElement('img');
      img.src = photo;
      selectedSeat.appendChild(img);
    }
    const nameDiv = document.createElement('div');
    nameDiv.innerText = name;
    nameDiv.style.fontWeight = 'bold';
    selectedSeat.appendChild(nameDiv);

    const memoDiv = document.createElement('div');
    memoDiv.innerText = memo;
    selectedSeat.appendChild(memoDiv);

    seatData[index] = { name, memo, photo };
    closePopup();
  };

  if (photoInput.files[0]) {
    reader.onload = (e) => updateSeat(e.target.result);
    reader.readAsDataURL(photoInput.files[0]);
  } else {
    updateSeat(null);
  }
}

function saveData() {
  const year = document.getElementById('year').value;
  localStorage.setItem(`seatData_${year}`, JSON.stringify(seatData));
  alert(`${year}년 저장 완료`);
}

function loadData() {
  const year = document.getElementById('year').value;
  const raw = localStorage.getItem(`seatData_${year}`);
  if (!raw) {
    alert(`${year}년 데이터가 없습니다.`);
    return;
  }
  seatData = JSON.parse(raw);
  const cols = parseInt(document.getElementById('cols').value);
  const total = seatData.length;
  const rows = Math.ceil(total / cols);
  document.getElementById('rows').value = rows;
  generateSeats();

  const seats = document.querySelectorAll('.seat');
  seatData.forEach((d, i) => {
    if (!d || !seats[i]) return;
    seats[i].innerHTML = '';
    if (d.photo) {
      const img = document.createElement('img');
      img.src = d.photo;
      seats[i].appendChild(img);
    }
    const nameDiv = document.createElement('div');
    nameDiv.innerText = d.name;
    nameDiv.style.fontWeight = 'bold';
    seats[i].appendChild(nameDiv);

    const memoDiv = document.createElement('div');
    memoDiv.innerText = d.memo;
    seats[i].appendChild(memoDiv);
  });
}
</script>
</body>
</html>
